---
/**
 * ThemeToggle.astro
 * - No hydration
 * - No framework dependency
 * - Uses public SVGs
 * - Tailwind dark mode compatible
 */
---

<button
  id="theme-toggle"
  type="button"
  aria-label="Toggle theme"
  class="relative inline-flex h-9 w-9 items-center justify-center rounded-md border border-border bg-secondary text-secondary-foreground transition hover:text-foreground focus:outline-none"
>
  <!-- Light icon -->
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="18"
    height="18"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="lucide dark:hidden lucide-sun-icon lucide-sun"
    ><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path
      d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path
      d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path
      d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path
      d="m19.07 4.93-1.41 1.41"></path></svg
  >

  <!-- Dark icon -->
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="18"
    height="18"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="lucide dark:block hidden lucide-moon-icon lucide-moon"
    ><path
      d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"
    ></path></svg
  >
</button>

<script is:inline>
  (() => {
    const STORAGE_KEY = "theme";
    const root = document.documentElement;
    const toggle = document.getElementById("theme-toggle");

    const getTheme = () => {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) return stored;
      return window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    };

    const applyTheme = (theme) => {
      root.classList.toggle("dark", theme === "dark");
      localStorage.setItem(STORAGE_KEY, theme);
    };

    // Initial paint (prevents flash)
    applyTheme(getTheme());

    toggle?.addEventListener("click", () => {
      applyTheme(root.classList.contains("dark") ? "light" : "dark");
    });
  })();
</script>
